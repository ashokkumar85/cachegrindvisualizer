<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:develar="http://neo-net.ru/2007/develar" width="100%" height="100%">
	
	<mx:Panel title="@Resource(bundle='CallGraph', key='configuration')" width="100%">
		<mx:Form>
			<mx:FormItem label="@Resource(bundle='CallGraph', key='minNodeCost')">
				<develar:NumericStepper id="minNodeCost" maximum="100" maxChars="3" change="handleChange(event)"/>
			</mx:FormItem>
			<mx:FormItem label="@Resource(bundle='CallGraph', key='labelType')">
				<mx:ComboBox id="labelType" change="handleChange(event)">
					<mx:Array>
						<mx:Object data="{Label.TYPE_PERCENTAGE_AND_TIME}" label="{localization.getString('labelTypePercentageAndTime')}"/>
						<mx:Object data="{Label.TYPE_TIME_AND_PERCENTAGE}" label="{localization.getString('labelTypeTimeAndPercentage')}"/>
						<mx:Object data="{Label.TYPE_PERCENTAGE}" label="{localization.getString('labelTypePercentage')}"/>
						<mx:Object data="{Label.TYPE_TIME}" label="{localization.getString('labelTypeTime')}"/>
					</mx:Array>
				</mx:ComboBox>
			</mx:FormItem>
			<mx:FormItem label="@Resource(bundle='CallGraph', key='rankDirection')">
				<mx:ComboBox id="rankDirection" change="handleChange(event)">
					<mx:Array>
						<mx:Object data="{Builder.RANK_DIRECTION_TB}" label="{localization.getString('rankDirectionTB')}"/>
						<mx:Object data="{Builder.RANK_DIRECTION_BT}" label="{localization.getString('rankDirectionBT')}"/>
						<mx:Object data="{Builder.RANK_DIRECTION_LR}" label="{localization.getString('rankDirectionLR')}"/>
						<mx:Object data="{Builder.RANK_DIRECTION_RL}" label="{localization.getString('rankDirectionRL')}"/>
					</mx:Array>
				</mx:ComboBox>
			</mx:FormItem>
			<mx:FormItem>
				<mx:CheckBox id="blackAndWhite" label="@Resource(bundle='CallGraph', key='blackAndWhite')" change="handleChange(event)"/>
			</mx:FormItem>
		</mx:Form>
		
		<mx:ControlBar width="100%">
			<mx:Button label="@Resource(bundle='CallGraph', key='loadConfiguration')" click="configurationManager.load()"/>
			<mx:Button label="@Resource(bundle='CallGraph', key='saveConfiguration')" click="configurationManager.save()"/>
		</mx:ControlBar>
	</mx:Panel>
	
	<mx:Script><![CDATA[
	
	import mx.formatters.DateFormatter;
	import mx.resources.ResourceBundle;
		
	import develar.filesystem.FileWrapper;	
	
	import develar.cachegrindVisualizer.Item;		
	import develar.cachegrindVisualizer.callGraph.builders.Builder;
	import develar.cachegrindVisualizer.callGraph.builders.Label;
	import develar.cachegrindVisualizer.callGraph.managers.ConfigurationManager;
	
	private var configurationManager:ConfigurationManager;
	
	[Bindable]
	[ResourceBundle('CallGraph')]
	private var localization:ResourceBundle;
	
	private var _builder:Builder = new Builder();
	public function get builder():Builder
	{
		return _builder;
	}
		
	private var fileWrapper:FileWrapper;
	
	public function build():void
	{
		if (configurationManager == null)
		{
			configurationManager = new ConfigurationManager(this);
			fileWrapper = new FileWrapper(Tab(parentDocument).fileWrapper.file.nativePath + '.dot');
		}
		
		builder.build(Item(Tab(parentDocument).tree.selectedItem), fileWrapper);
		
		var dateFormatter:DateFormatter = new DateFormatter();
		dateFormatter.formatString = 'J:NN:SS';			
		parentApplication.status = dateFormatter.format(new Date()) + ' ' + ResourceBundle.getResourceBundle('CachegrindVisualizer').getString('graphBuilt');
	}
	
	private function handleChange(event:Event):void
	{
		if (event.target is ComboBox)
		{
			if (event.target == rankDirection)
			{
				builder.rankDirection = event.target.selectedItem.data;
			}
			else
			{
				builder.label.type = event.target.selectedItem.data;
			}
		}	
		else if (event.target is CheckBox)
		{
			builder.blackAndWhite = event.target.selected;
		}
		else
		{
			builder.minNodeCost = minNodeCost.value;
		}
		
		build();
	}
	
	]]></mx:Script>
	
</mx:VBox>